# Event Implementation Spec


## Event Flow

An incoming event triggers execution tasks of all the models associated with the event. Detailed description of an event flow: 

- Event class verifies models are of valid type
- Resolver fetches data for all the associated models
- Lifecycle of all models associated with the event are fetched
- Rule engine is queried to get execution tasks of each life cycle based on the event and model data
- Tasks are executed to generated 
- Transaction is generated for the outputs generated by tasks
- Transaction is commited


```javascript
enum DataTypes {
  ...
}

interface Model {
  [key: string]: DataTypes
}

class Event <M extends Model, .... V> {
  readonly models: M[];

  // validate models are of valid Model
  constructor(M....m, V...v) {
    foreach(m_ : m)  {
      assert(typeof(m_ in M));
    }
  }
}


class DelhiveryPromise {
  function process<Event> (Event e) {

    // gets data by hitting db
    data = e.models.reduce((acc, model) => {
      acc.append(resolve(model));
    }, []}

    // get reference to the lifecycle of models
    lifecycles = e.model.reduce((acc, model) => {
      acc.append(getLifeCycleFunction(typeof model));

      return acc;
    }, []);

    // get tasks of a particular lifecycle
    handlers = lifecycles.reduce((acc, lifecycle) => {
      handler = lifecycle.evaluate(type of e, data);
      acc.append(handler)

      return acc;
    }, []);


    // execute tasks
    changes = handlers.reduce((acc, handler) => {
      output = handler.execute(data);
      acc.push.back(output);

      return acc;
    });

    // create transactions
    transaction = changes.reduce((acc, handler) => {
      acc.append({
        oldValue: change.oldValue,
        newValue: change.newValue,
      });

      return acc;
    });

    // do commit
    db.commit(transactions)
  }
}

```
